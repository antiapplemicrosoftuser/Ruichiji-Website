<!-- _includes/head.html - Head meta + Open Graph + Twitter Card for Jekyll (GitHub Pages, subpath-safe) -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

{%- comment -%}
  Meta resolution order:
    title: page.title -> site.title
    description: page.description -> page.excerpt -> site.description -> fallback
    og_image: page.og_image -> page.image -> site.social_image -> /assets/images/social-preview.png -> /assets/images/default-cover.svg
  Make sure you set `url` in _config.yml (for absolute_url to produce correct absolute URLs on GitHub Pages).
{%- endcomment -%}

{%- assign meta_title = page.title | default: site.title | default: "Ruichiji - Official Website" -%}
{%- assign meta_site_title = site.title | default: "Ruichiji - Official Website" -%}
{%- assign meta_description = page.description | default: page.excerpt | default: site.description | default: "Ruichiji - Official Website" -%}

{%- comment -%}
  Prefer a PNG (1200x630) for social previews. Use site.social_image in _config.yml if available.
{%- endcomment -%}
{%- assign meta_image_path = page.og_image | default: page.image | default: site.social_image | default: "/assets/images/social-preview.png" | default: "/assets/images/default-cover.svg" -%}
{%- assign meta_image = meta_image_path | absolute_url -%}
{%- assign canonical = page.url | absolute_url -%}

<title>{% if page.title %}{{ page.title }} | {{ meta_site_title }}{% else %}{{ meta_site_title }}{% endif %}</title>
<link rel="canonical" href="{{ canonical }}" />
<meta name="description" content="{{ meta_description | strip_newlines | strip_html | truncate: 200 }}" />

<!-- Favicon / touch icons -->
<link rel="icon" href="{{ '/assets/images/default-cover.svg' | absolute_url }}" type="image/svg+xml" />
<link rel="apple-touch-icon" href="{{ '/assets/images/default-cover.svg' | absolute_url }}" />

<!-- Open Graph -->
<meta property="og:site_name" content="{{ meta_site_title }}" />
{%- if page.layout == "post" or page.collection == "posts" -%}
  <meta property="og:type" content="article" />
{%- else -%}
  <meta property="og:type" content="website" />
{%- endif -%}
<meta property="og:title" content="{{ meta_title | escape }}" />
<meta property="og:description" content="{{ meta_description | strip_html | strip_newlines | truncate: 300 }}" />
<meta property="og:url" content="{{ canonical }}" />
<meta property="og:image" content="{{ meta_image }}" />
<meta property="og:image:alt" content="{{ meta_site_title }}" />
{%- if site.locale -%}
  <meta property="og:locale" content="{{ site.locale }}" />
{%- else -%}
  <meta property="og:locale" content="en_US" />
{%- endif -%}

{%- if page.layout == "post" or page.collection == "posts" -%}
  {%- if page.date -%}
    <meta property="article:published_time" content="{{ page.date | date_to_xmlschema }}" />
  {%- endif -%}
  {%- if page.last_modified_at or page.updated -%}
    <meta property="article:modified_time" content="{{ page.last_modified_at | default: page.updated | date_to_xmlschema }}" />
  {%- endif -%}
  {%- if page.author or site.author -%}
    {%- assign og_author = page.author | default: site.author -%}
    <meta property="article:author" content="{{ og_author }}" />
  {%- endif -%}
{%- endif -%}

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="{{ meta_title | escape }}" />
<meta name="twitter:description" content="{{ meta_description | strip_html | strip_newlines | truncate: 300 }}" />
<meta name="twitter:image" content="{{ meta_image }}" />
{%- if site.twitter_username -%}
  <meta name="twitter:site" content="@{{ site.twitter_username | remove: '@' }}" />
  <meta name="twitter:creator" content="@{{ page.author_twitter | default: site.twitter_username | remove: '@' }}" />
{%- endif -%}

{%- comment -%}
  Minimal JSON-LD structured data for improved indexing / rich results.
  Replace logo URL if you have a dedicated logo file.
{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebSite",
  "url": "{{ site.url | default: '/' | absolute_url }}",
  "name": "{{ meta_site_title | escape }}",
  "description": "{{ meta_description | strip_html | strip_newlines | truncate: 300 | escape }}",
  "publisher": {
    "@type": "Organization",
    "name": "{{ meta_site_title | escape }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ meta_image }}",
      "width": 1200,
      "height": 630
    }
  }
}
</script>

{%- comment -%}
  Notes:
  - GitHub Pages served SVGs are valid files, but many social scrapers (Discord, X/Twitter, Facebook)
    do not reliably render SVG as og:image. Prefer a PNG or JPEG (1200x630) for og:image/twitter:image.
  - Ensure _config.yml contains:
      url: "https://<your-username>.github.io/Ruichiji-Website"
      social_image: "/assets/images/social-preview.png"   # optional
  - If you change the image but the preview doesn't update, change the image URL (e.g. add ?v=timestamp)
    to force scrapers to refetch.
{%- endcomment -%}